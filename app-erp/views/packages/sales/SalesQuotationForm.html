<div id="content" ng-app="app.erp" ng-controller="SalesQuotationFormCtrl" ng-class="{'sedangSubmitForm': form.submitted}">
    <div class="row">
        <big-breadcrumbs items="['Customer', 'Sales Quotation Form']" icon="table" class="col-xs-12 col-sm-7 col-md-7 col-lg-4"></big-breadcrumbs>
    </div>
    <div class="jarviswidget">
        <header>
            <span class="widget-icon"> <i class="fa fa-edit"></i> </span>
            <h2>Sales Quotation Form</h2>
        </header>
        <div class="widget-body">
            <div class="alert alert-info" style="margin-bottom: 20px">
                <div class="toolBarTop toolbar transparent" style="height: 33px">
                    <button class="pull-left btn btn-primary" ng-click="saveData()" ng-show="Is_Writeable">
                        <i class="fa fa-save"></i> Save
                    </button>
                    <div class="pull-left" style="width: 50px; text-align: center; padding-top: 5px">
                        <i class="fa fa-spinner fa-spin" style="font-size: 24px; display: none" id="idLoading"></i>&nbsp;
                    </div>
                    <button style="float: right" type="button" class="btn btn-default" data-ui-sref="app.erp.salesQuotationList">
                        <i class="fa fa-sign-out"></i> Back
                    </button>
                </div>
            </div>

            <!-- Form Header -->
            <form class="smart-form">
                <fieldset>
                    <div class="row">
                        <section class="col col-3">
                            <span class="help-block">Customer <span style="color: red">*</span></span>
                            <label class="input">
                                <input type="text" class="form-control form-control-sm" 
                                       placeholder="Nama / Code Customer" autocomplete="off"
                                       uib-typeahead="item as (item.Code + ' - ' + item.Name) for item in getData_Customer($viewValue)"
                                       ng-model="model.selectedCustomer"
                                       typeahead-on-select="CustomerSelected()"
                                       ng-readonly="!Is_Create"
                                       ng-required="true" />
                            </label>
                        </section>
                        <section class="col col-3">
                            <span class="help-block">Branch <span style="color: red">*</span></span>
                            <label class="input">
                                <select class="form-control form-control-sm" ng-model="model.BranchCode" ng-required="true">
                                    <option value="">Select an Item</option>
                                    <option value="PKS">PKS - Peksi</option>
                                    <option value="SBY">SBY - Surabaya</option>
                                </select>
                            </label>
                        </section>
                        <section class="col col-2">
                            <span class="help-block">Status <span style="color: red">*</span></span>
                            <label class="input">
                                <select class="form-control form-control-sm" ng-model="model.Status" ng-required="true">
                                    <option value="">Select an Item</option>
                                    <option value="Draft">Draft</option>
                                    <option value="Submitted">Submitted</option>
                                    <option value="Approved">Approved</option>
                                </select>
                            </label>
                        </section>
                        <section class="col col-2">
                            <span class="help-block">Date <span style="color: red">*</span></span>
                            <label class="input">
                                <input type="text" class="form-control form-control-sm" 
                                       datepicker-popup="dd/MM/yyyy"
                                       ng-model="model.Date"
                                       is-open="datePicker.Date"
                                       ng-click="datePicker.Date = true"
                                       ng-required="true" />
                                <i class="fa fa-calendar" style="position: absolute; right: 10px; top: 8px; cursor: pointer" ng-click="datePicker.Date = true"></i>
                            </label>
                        </section>
                    </div>

                    <div class="row">
                        <section class="col col-3">
                            <span class="help-block">Bill To <span style="color: red">*</span></span>
                            <label class="input">
                                <select class="form-control form-control-sm" ng-model="model.BillToId">
                                    <option value="">Select an Item</option>
                                    <option value="Office">Office</option>
                                </select>
                            </label>
                        </section>
                        <section class="col col-3">
                            <span class="help-block">Category <span style="color: red">*</span></span>
                            <label class="input">
                                <select class="form-control form-control-sm" ng-model="model.CategoryCode">
                                    <option value="">Select an Item</option>
                                </select>
                            </label>
                        </section>
                        <section class="col col-2">
                            <span class="help-block">Code <span style="color: red">*</span></span>
                            <label class="input">
                                <input type="text" class="form-control form-control-sm" 
                                       ng-model="model.Code" 
                                       placeholder="PKS-QUOT-13621"
                                       ng-readonly="!Is_Create" />
                                <i class="fa fa-refresh" style="position: absolute; right: 10px; top: 8px; cursor: pointer"></i>
                            </label>
                        </section>
                        <section class="col col-2">
                            <span class="help-block">Expected Order <span style="color: red">*</span></span>
                            <label class="input">
                                <input type="text" class="form-control form-control-sm" 
                                       datepicker-popup="dd/MM/yyyy"
                                       ng-model="model.ExpectedOrder"
                                       is-open="datePicker.ExpectedOrder"
                                       ng-click="datePicker.ExpectedOrder = true"
                                       placeholder="dd/mm/yyyy" />
                                <i class="fa fa-calendar" style="position: absolute; right: 10px; top: 8px; cursor: pointer" ng-click="datePicker.ExpectedOrder = true"></i>
                            </label>
                        </section>
                    </div>

                    <div class="row">
                        <section class="col col-3">
                            <span class="help-block">Sales <span style="color: red">*</span></span>
                            <label class="input">
                                <select class="form-control form-control-sm" ng-model="model.SalesId">
                                    <option value="">Select an Item</option>
                                    <option value="Budiiono">Budiiono (Sales Officer)</option>
                                </select>
                            </label>
                        </section>
                        <section class="col col-3">
                            <span class="help-block">Project</span>
                            <label class="input">
                                <select class="form-control form-control-sm" ng-model="model.ProjectId">
                                    <option value="">Select an Item</option>
                                </select>
                            </label>
                        </section>
                        <section class="col col-4">
                            <span class="help-block">Expired Date <span style="color: red">*</span></span>
                            <label class="input">
                                <input type="text" class="form-control form-control-sm" 
                                       datepicker-popup="dd/MM/yyyy"
                                       ng-model="model.ExpiredDate"
                                       is-open="datePicker.ExpiredDate"
                                       ng-click="datePicker.ExpiredDate = true" />
                                <i class="fa fa-calendar" style="position: absolute; right: 10px; top: 8px; cursor: pointer" ng-click="datePicker.ExpiredDate = true"></i>
                            </label>
                        </section>
                    </div>

                    <div class="row">
                        <section class="col col-3">
                            <span class="help-block">PIC <span style="color: red">*</span></span>
                            <label class="input">
                                <input type="text" class="form-control form-control-sm" ng-model="model.PIC" />
                            </label>
                        </section>
                        <section class="col col-3">
                            <span class="help-block">Marketing <span style="color: red">*</span></span>
                            <label class="input">
                                <select class="form-control form-control-sm" ng-model="model.MarketingId">
                                    <option value="">Select an Item</option>
                                    <option value="Desi">Desi Adelia (Marketing Sr.)</option>
                                </select>
                            </label>
                        </section>
                        <section class="col col-2">
                            <span class="help-block">Currency <span style="color: red">*</span></span>
                            <label class="input">
                                <select class="form-control form-control-sm" ng-model="model.CurrencyCode">
                                    <option value="">Select an Item</option>
                                    <option value="IDR">IDR</option>
                                    <option value="USD">USD</option>
                                </select>
                            </label>
                        </section>
                    </div>

                    <div class="row">
                        <section class="col col-10">
                            <span class="help-block">Notes</span>
                            <label class="input">
                                <textarea class="form-control form-control-sm" ng-model="model.Notes" rows="3" style="resize: vertical"></textarea>
                            </label>
                        </section>
                    </div>
                </fieldset>
            </form>

            <!-- Main Quotation Items -->
            <div style="margin-top: 30px">
                <div class="panel-heading" style="background-color: #e3f2fd; padding: 12px 15px; border: 1px solid #90caf9; border-bottom: none">
                    <strong style="font-size: 14px">Main Quotation Items</strong>
                </div>
                <div class="alert alert-info" style="margin: 0; border-radius: 0; border-top: none">
                    <div class="toolBarTop toolbar transparent">
                        <button class="btn btn-default btn-sm" ng-click="AddMainItem()" ng-disabled="!Is_Writeable">
                            <i class="fa fa-file-o"></i> New Item
                        </button>
                        <button class="btn btn-default btn-sm" ng-click="BrowseItems()" ng-disabled="!Is_Writeable">
                            <i class="fa fa-folder-open-o"></i> Browse Items
                        </button>
                        <button class="btn btn-default btn-sm" ng-click="ShowStock()" ng-disabled="!Is_Writeable">
                            <i class="fa fa-cubes"></i> Show Stock
                        </button>
                        <button class="btn btn-default btn-sm" ng-click="ShowAlternateQuotation()" ng-disabled="!Is_Writeable">
                            <i class="fa fa-exchange"></i> Alternate Quotation
                        </button>
                    </div>
                </div>
                <div class="table-responsive">
                    <table class="table table-bordered table-condensed" style="margin-bottom: 0">
                        <thead style="background-color: #e3f2fd">
                            <tr>
                                <th style="width: 40px; text-align: center"></th>
                                <th style="width: 40px; text-align: center">No.</th>
                                <th style="min-width: 150px">Item Code</th>
                                <th style="min-width: 200px">Description</th>
                                <th style="width: 60px; text-align: center">Qty</th>
                                <th style="width: 70px; text-align: center">Uom</th>
                                <th style="width: 60px; text-align: center">Qty</th>
                                <th style="width: 70px; text-align: center">Uom</th>
                                <th style="width: 60px; text-align: center">Qty</th>
                                <th style="width: 70px; text-align: center">Uom</th>
                                <th style="width: 90px; text-align: center">Total Qty</th>
                                <th style="width: 70px; text-align: center">Uom</th>
                                <th style="width: 110px; text-align: right">Unit Amount</th>
                                <th style="width: 120px; text-align: right">Total Amount</th>
                                <th style="width: 80px; text-align: center">Disc. (%)</th>
                                <th style="width: 120px; text-align: right">Sub Total</th>
                                <th style="width: 100px; text-align: center">VAT Code</th>
                                <th style="width: 80px; text-align: center">VAT (%)</th>
                                <th style="width: 120px; text-align: right">Total</th>
                                <th style="width: 80px; text-align: center">Stock</th>
                                <th style="width: 100px; text-align: center">Confirm Order</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="row in details.MainItems | filter:{Deleted: 0}" ng-class="{'success-row': row.IsConfirmed}">
                                <td style="text-align: center; vertical-align: middle">
                                    <button type="button" class="btn btn-xs btn-danger" ng-click="RemoveMainItem(row['recordNumber'])" ng-show="Is_Writeable">
                                        <i class="fa fa-trash-o"></i>
                                    </button>
                                </td>
                                <td style="text-align: center; vertical-align: middle">{{$index + 1}}</td>
                                <td style="vertical-align: middle">
                                    <div style="display: flex; align-items: center">
                                        <input type="text" class="form-control input-xs" 
                                               placeholder="Item Code" 
                                               ng-model="row['ItemCode']"
                                               ng-readonly="row['ItemCode']"
                                               style="width: 120px" />
                                        <i class="fa fa-close" style="cursor: pointer; margin-left: 5px; color: #999"
                                           ng-show="Is_Writeable && row['ItemCode']"
                                           ng-click="ClearItem(row)"></i>
                                    </div>
                                </td>
                                <td style="vertical-align: middle">{{ row['Description'] }}</td>
                                <td style="text-align: center; vertical-align: middle">
                                    <input type="number" class="form-control input-xs text-center" 
                                           ng-model="row['Qty1']" 
                                           ng-change="CalculateRow(row)"
                                           style="width: 50px" />
                                </td>
                                <td style="text-align: center; vertical-align: middle">
                                    <select class="form-control input-xs" ng-model="row['Uom1']" style="width: 60px">
                                        <option value="BTG">BTG</option>
                                        <option value="PCS">PCS</option>
                                        <option value="DUS">DUS</option>
                                    </select>
                                </td>
                                <td style="text-align: center; vertical-align: middle">
                                    <input type="number" class="form-control input-xs text-center" 
                                           ng-model="row['Qty2']" 
                                           ng-change="CalculateRow(row)"
                                           style="width: 50px" />
                                </td>
                                <td style="text-align: center; vertical-align: middle">
                                    <select class="form-control input-xs" ng-model="row['Uom2']" style="width: 60px">
                                        <option value="BTG">BTG</option>
                                        <option value="PCS">PCS</option>
                                        <option value="DUS">DUS</option>
                                    </select>
                                </td>
                                <td style="text-align: center; vertical-align: middle">
                                    <input type="number" class="form-control input-xs text-center" 
                                           ng-model="row['Qty3']" 
                                           ng-change="CalculateRow(row)"
                                           style="width: 50px" />
                                </td>
                                <td style="text-align: center; vertical-align: middle">
                                    <select class="form-control input-xs" ng-model="row['Uom3']" style="width: 60px">
                                        <option value="BTG">BTG</option>
                                        <option value="PCS">PCS</option>
                                        <option value="DUS">DUS</option>
                                    </select>
                                </td>
                                <td style="text-align: right; vertical-align: middle">{{ row['TotalQty'] | number:0 }}</td>
                                <td style="text-align: center; vertical-align: middle">{{ row['TotalUom'] }}</td>
                                <td style="vertical-align: middle">
                                    <input type="text" class="form-control input-xs text-right" 
                                           ng-model="row['UnitAmount']"
                                           ng-change="CalculateRow(row)" />
                                </td>
                                <td style="text-align: right; vertical-align: middle">{{ row['TotalAmount'] | number:0 }}</td>
                                <td style="vertical-align: middle">
                                    <input type="number" class="form-control input-xs text-center" 
                                           ng-model="row['DiscountPercent']"
                                           ng-change="CalculateRow(row)"
                                           style="width: 60px" />
                                </td>
                                <td style="text-align: right; vertical-align: middle">{{ row['SubTotal'] | number:0 }}</td>
                                <td style="vertical-align: middle">
                                    <select class="form-control input-xs" ng-model="row['VATCode']" ng-change="CalculateRow(row)" style="width: 90px">
                                        <option value="PPN">PPN 11%</option>
                                    </select>
                                </td>
                                <td style="text-align: center; vertical-align: middle">{{ row['VATPercent'] }}</td>
                                <td style="text-align: right; vertical-align: middle; font-weight: bold">{{ row['Total'] | number:0 }}</td>
                                <td style="text-align: center; vertical-align: middle">
                                    <span class="badge" ng-class="row['StockQty'] > 100 ? 'badge-success' : (row['StockQty'] > 0 ? 'badge-warning' : 'badge-danger')" style="font-size: 11px">
                                        {{ row['StockQty'] | number:0 }}
                                    </span>
                                </td>
                                <td style="text-align: center; vertical-align: middle">
                                    <input type="checkbox" ng-model="row['IsConfirmed']" style="transform: scale(1.3)" />
                                </td>
                            </tr>
                            <tr ng-if="!details.MainItems || details.MainItems.length == 0">
                                <td colspan="21" class="text-center" style="padding: 20px; color: #999"><i>Tidak ada data..</i></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Alternate Quotation Items -->
            <div style="margin-top: 30px">
                <div class="panel-heading" style="background-color: #8d6e63; color: white; padding: 12px 15px; border: 1px solid #6d4c41; border-bottom: none">
                    <strong style="font-size: 14px">Alternate Quotation Items</strong>
                </div>
                <div class="alert alert-info" style="margin: 0; border-radius: 0; border-top: none">
                    <div class="toolBarTop toolbar transparent">
                        <button class="btn btn-default btn-sm" ng-click="AddAlternateItem()" ng-disabled="!Is_Writeable">
                            <i class="fa fa-file-o"></i> New Item
                        </button>
                        <button class="btn btn-default btn-sm" ng-click="BrowseAlternateItems()" ng-disabled="!Is_Writeable">
                            <i class="fa fa-folder-open-o"></i> Browse Items
                        </button>
                        <button class="btn btn-default btn-sm" ng-click="ShowStockAlternate()" ng-disabled="!Is_Writeable">
                            <i class="fa fa-cubes"></i> Show Stock
                        </button>
                    </div>
                </div>
                <div class="table-responsive">
                    <table class="table table-bordered table-condensed" style="margin-bottom: 0">
                        <thead style="background-color: #a1887f; color: white">
                            <tr>
                                <th style="width: 40px; text-align: center"></th>
                                <th style="width: 40px; text-align: center">No.</th>
                                <th style="min-width: 150px">Item Code</th>
                                <th style="min-width: 200px">Description</th>
                                <th style="width: 60px; text-align: center">Qty</th>
                                <th style="width: 70px; text-align: center">Uom</th>
                                <th style="width: 60px; text-align: center">Qty</th>
                                <th style="width: 70px; text-align: center">Uom</th>
                                <th style="width: 60px; text-align: center">Qty</th>
                                <th style="width: 70px; text-align: center">Uom</th>
                                <th style="width: 90px; text-align: center">Total Qty</th>
                                <th style="width: 70px; text-align: center">Uom</th>
                                <th style="width: 110px; text-align: right">Unit Amount</th>
                                <th style="width: 120px; text-align: right">Total Amount</th>
                                <th style="width: 80px; text-align: center">Disc. (%)</th>
                                <th style="width: 120px; text-align: right">Sub Total</th>
                                <th style="width: 100px; text-align: center">VAT Code</th>
                                <th style="width: 80px; text-align: center">VAT (%)</th>
                                <th style="width: 120px; text-align: right">Total</th>
                                <th style="width: 80px; text-align: center">Stock</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="row in details.AlternateItems | filter:{Deleted: 0}">
                                <td style="text-align: center; vertical-align: middle">
                                    <button type="button" class="btn btn-xs btn-danger" ng-click="RemoveAlternateItem(row['recordNumber'])" ng-show="Is_Writeable">
                                        <i class="fa fa-trash-o"></i>
                                    </button>
                                </td>
                                <td style="text-align: center; vertical-align: middle">{{$index + 1}}</td>
                                <td style="vertical-align: middle">
                                    <div style="display: flex; align-items: center">
                                        <input type="text" class="form-control input-xs" 
                                               placeholder="Item Code" 
                                               ng-model="row['ItemCode']"
                                               style="width: 120px" />
                                        <i class="fa fa-close" style="cursor: pointer; margin-left: 5px; color: #999"
                                           ng-show="Is_Writeable && row['ItemCode']"
                                           ng-click="ClearAlternateItem(row)"></i>
                                    </div>
                                </td>
                                <td style="vertical-align: middle">{{ row['Description'] }}</td>
                                <td style="text-align: center; vertical-align: middle">
                                    <input type="number" class="form-control input-xs text-center" ng-model="row['Qty1']" style="width: 50px" />
                                </td>
                                <td style="text-align: center; vertical-align: middle">
                                    <select class="form-control input-xs" ng-model="row['Uom1']" style="width: 60px">
                                        <option value="DUS">DUS</option>
                                        <option value="PCS">PCS</option>
                                    </select>
                                </td>
                                <td style="text-align: center; vertical-align: middle">
                                    <input type="number" class="form-control input-xs text-center" ng-model="row['Qty2']" style="width: 50px" />
                                </td>
                                <td style="text-align: center; vertical-align: middle">
                                    <select class="form-control input-xs" ng-model="row['Uom2']" style="width: 60px">
                                        <option value="DUS">DUS</option>
                                        <option value="PCS">PCS</option>
                                    </select>
                                </td>
                                <td style="text-align: center; vertical-align: middle">
                                    <input type="number" class="form-control input-xs text-center" ng-model="row['Qty3']" style="width: 50px" />
                                </td>
                                <td style="text-align: center; vertical-align: middle">
                                    <select class="form-control input-xs" ng-model="row['Uom3']" style="width: 60px">
                                        <option value="DUS">DUS</option>
                                        <option value="PCS">PCS</option>
                                    </select>
                                </td>
                                <td style="text-align: right; vertical-align: middle">{{ row['TotalQty'] | number:0 }}</td>
                                <td style="text-align: center; vertical-align: middle">{{ row['TotalUom'] }}</td>
                                <td style="vertical-align: middle">
                                    <input type="text" class="form-control input-xs text-right" ng-model="row['UnitAmount']" />
                                </td>
                                <td style="text-align: right; vertical-align: middle">{{ row['TotalAmount'] | number:0 }}</td>
                                <td style="vertical-align: middle">
                                    <input type="number" class="form-control input-xs text-center" ng-model="row['DiscountPercent']" style="width: 60px" />
                                </td>
                                <td style="text-align: right; vertical-align: middle">{{ row['SubTotal'] | number:0 }}</td>
                                <td style="vertical-align: middle">
                                    <select class="form-control input-xs" ng-model="row['VATCode']" style="width: 90px">
                                        <option value="PPN">PPN 11%</option>
                                    </select>
                                </td>
                                <td style="text-align: center; vertical-align: middle">{{ row['VATPercent'] }}</td>
                                <td style="text-align: right; vertical-align: middle; font-weight: bold">{{ row['Total'] | number:0 }}</td>
                                <td style="text-align: center; vertical-align: middle">
                                    <span class="badge badge-success" style="font-size: 11px">{{ row['StockQty'] | number:0 }}</span>
                                </td>
                            </tr>
                            <tr ng-if="!details.AlternateItems || details.AlternateItems.length == 0">
                                <td colspan="20" class="text-center" style="padding: 20px; color: #999"><i>Tidak ada data..</i></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

        </div>
    </div>
</div>

<style>
    .sedangSubmitForm .ng-invalid {
        border-color: #b94a48 !important;
        border-width: 2px !important;
    }

    .form-control-sm {
        height: 32px;
        padding: 5px 10px;
        font-size: 13px;
    }

    .input-xs {
        height: 26px !important;
        padding: 2px 6px !important;
        font-size: 12px !important;
    }

    .table-bordered > thead > tr > th,
    .table-bordered > tbody > tr > td {
        border: 1px solid #ddd;
        padding: 6px 8px;
        vertical-align: middle;
        font-size: 12px;
    }

    .table-condensed > thead > tr > th,
    .table-condensed > tbody > tr > td {
        padding: 5px 6px;
    }

    .text-right {
        text-align: right;
    }

    .text-center {
        text-align: center;
    }

    .success-row {
        background-color: #d4edda !important;
    }

    .badge {
        padding: 4px 8px;
        border-radius: 3px;
        font-weight: normal;
    }

    .badge-success {
        background-color: